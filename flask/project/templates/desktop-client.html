{% extends "header.html" %}

{% block body %}
<div class="container">
    <div class="row">
        Brand:  <select class="custom-select" id="brand-filter">
                    <option selected value="">None</option>
                    {% for brand in filters.brand %}
                        <option value="{{brand}}">{{brand}}</option>
                    {% endfor %}
                </select>
        Processor:  <select  class="custom-select" id="processor-filter">
                        <option selected value="">None</option>
                        {% for processor in filters.processor %}
                            <option value="{{processor}}">{{processor}}</option>
                        {% endfor %}
                    </select>
        <button id="filter-submit">Search</button>
        <div id="item-count" class="text-right" style="float: right"></div> 
    </div>
</div>
<div id="itemContainer" class="container">
    <!-- all the items get appended in this container -->
</div>

<script>
    $(document).ready(function() {
        getDesktopData(null);

        $('#filter-submit').click(function() {
            var filters =  {};
            var brandFilter = $('#brand-filter').val();
            var processorFilter = $('#processor-filter').val();

            if (brandFilter != '') {
                filters['brand'] = brandFilter;
            }

            if (processorFilter != '') {
                filters['processor'] = processorFilter;
            }

            console.log("filters: %o", filters);
            getDesktopData(filters);
        });
    });

    function getDesktopData(filters) {
        $.ajax({
            type: "GET",
            url: "/desktop-client/table",
            dataType: 'json',
            data: filters,
            beforeSend: function() {
                //loading gif logic goes here.
            },
            success: function(response) {
                $('#itemContainer').empty();
                console.log("response data: %o", response.data);
                if (response.data != null) {
                    for (var i = 0; i < response.data.length; i++) {
                        $('#itemContainer').append(desktopElement(response.data[i]));
                    }
                }

                $('#item-count').text("Number of items : " + response.data.length);
            }
        }); 
    }

    function desktopElement(response) {
        var data = response[0];
        var count = response[1];

        return [
            '<div class="product-container">',
                '<div class="product-subcontainer text-left">',
                    '<img class="product-image" src="https://www.staples-3p.com/s7/is/image/Staples/m006008801_sc7?$splssku$">',
                    '<div class="price">$' + data.price + '</div>',
                    '<div class="brand">'+ data.brand + '</div>',
                    '<div class="info-container text-left">',
                        '<div>Weight: ' + data.weight + 'kg</div>',
                        '<div>Processor: ' + data.processor + '</div>',
                        '<div>Ram Size: ' + data.ram_size + '</div>',
                        '<div>CPU Cores: ' + data.cpu_cores + '</div>',
                        '<div>Hard Drive Space: ' + data.hd_size + 'Gb</div>',
                        '<div>Dimensions: ' + data.dimensions + '</div>',
                    '</div>',
                '</div>',
            '</div>',
        ].join("\n");
    }
</script>
<style>
    .loader {
        border: 16px solid #f3f3f3; /* Light grey */
        border-top: 16px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 120px;
        height: 120px;
        animation: spin 2s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    #itemContainer {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }

    .product-image {
        width: 100%;
    }

    .product-container {
      position: relative;
      width: 25%;
      padding: 10px;
      box-sizing: border-box;
    }

    .product-subcontainer {
        position: relative;
        width: 100%;
        height: 100%;
        /*border: solid 2px black;*/
        background-color: white;    
        padding: 20px;
    }

    .product-container .price {
        font-weight: bold;
        font-size: 18px !important;
    }

    @media (max-width: 992px) {
        .product-container {
            width: 33.33%;
        }
    }

</style>
{% endblock %}

